<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoMoBot</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        #chat-container {
            width: 60vw;
            margin: 50px auto;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            overflow-y: auto;
            /* 当内容超出容器高度时启用垂直滚动条 */
            max-height: 80vh;
            /* 设置最大高度为80%的视口高度 */
            display: flex;
            flex-direction: column;
            /* 垂直布局 */
        }

        #user-input {
            width: calc(100% - 20px);
            /* 宽度减去左右 padding */
            box-sizing: border-box;
            /* 让 padding 不影响元素宽度 */
            resize: none;
            /* 禁止用户调整输入框大小 */
            margin-bottom: 10px;
            /* 设置输入框与按钮之间的间距 */
            min-height: 3em;
            /* 设置最小高度为3行 */
        }

        .message {
            margin-bottom: 10px;
            /* 信息之间的间距 */
            padding: 10px;
            /* 内边距 */
            border-radius: 5px;
            /* 边框圆角 */
        }

        .default {
            background-color: #e1e1e6;
        }

        .user-message {
            background-color: #e0f7fa;
            /* 用户信息背景色 */
        }

        .bot-message {
            background-color: #b2dfdb;
            /* Bot 信息背景色 */
        }

        #send-button {
            width: 100px;
            /* 设置按钮宽度 */
            margin-right: 20px;
            /* 设置按钮与右侧的间距 */
        }
    </style>
</head>

<body>

    <div id="chat-container">
        <div class="message default" id="chat-output"></div>
        <textarea id="user-input" placeholder="输入消息..." rows="3"></textarea>
        <button id="send-button" onclick="sendMessage()">发送</button>
    </div>

    <script>
        function adjustInputHeight() {
            var userInput = document.getElementById('user-input');
            userInput.style.height = 'auto'; // 重置高度
            userInput.style.height = userInput.scrollHeight + 'px'; // 动态设置高度
        }

        function scrollToBottom() {
            var chatContainer = document.getElementById('chat-container');
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function sendMessage() {
            var userInput = document.getElementById('user-input').value;
            var sendButton = document.getElementById('send-button');

            sendButton.disabled = true;

            // 发送用户输入到服务器
            fetch('/process_input', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'user_input=' + encodeURIComponent(userInput),
            })
                .then(response => response.json())
                .then(data => {
                    // 将服务器返回的回复添加到聊天输出区域
                    var chatOutput = document.getElementById('chat-output');
                    chatOutput.innerHTML += '<div class="message user-message">' + userInput.replace(/\n/g, '<br>') + '</div>';
                    chatOutput.innerHTML += '<div class="message bot-message">' + data.bot_reply.replace(/\n/g, '<br>') + '</div>';

                    // 清空输入框
                    document.getElementById('user-input').value = '';

                    // 调整输入框高度
                    adjustInputHeight();

                    // 滚动到底部
                    scrollToBottom();

                    sendButton.disabled = false;

                    document.getElementById('user-input').focus();
                })
                .catch(error => {
                    console.error('Error sending message:', error);
                    sendButton.isabled = false;
                });
        }

        // 在输入框内容变化时调整高度
        document.getElementById('user-input').addEventListener('input', adjustInputHeight);
        // 页面加载时滚动到底部
        window.onload = scrollToBottom;
        // 将光标聚焦到输入框
        document.getElementById('user-input').focus();
    </script>

</body>

</html>